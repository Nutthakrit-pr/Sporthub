// var product = [{
//     id : 1,
//     img : 'img/ball1.jpg ',
//     name : 'UCL Ball',
//     price : 3299,
//     description: 'UCL Ball , Since Messi scored hattrick in 2008 and finally got to be champions and MVP ',
//     type : 'Football'
// },{
//     id : 2,
//     img: 'img/ball2.jpg',
//     name : 'Football Boots',    
//     price: 11900,
//     description: 'Football boots (also called soccer cleats) are specialized footwear designed to provide players with optimal traction, comfort, and performance on the pitch. They are tailored for the unique demands of football, including running, quick changes of direction, kicking, and tackling. ',
//     type : 'Football'

// },{
//     id: 3,
//     img: 'img/ball3.jpg',
//     name : 'Goalkeeper Gloves',
//     price: 1490,
//     description: 'Goalkeeper gloves are specialized equipment worn by goalkeepers in soccer (football) to improve grip, protect the hands, and enhance performance during matches or training.',
//     type: 'Football'

// },{
//     id: 4,
//     img: 'img/ball4.jpg',
//     name : 'Shin Guard',
//     price: 499,
//     description: 'Shin guards are essential protective equipment worn in football (soccer), and many other sports, to shield the shins from impacts, such as kicks, tackles, or strikes from the ball.',
//     type: 'Football'

// },{
//     id: 5,
//     img: 'img/ball5.jpg',
//     name : 'Football Sock',
//     price: 599,
//     description: 'Football socks are an essential part of a football players uniform, designed to provide comfort, support, and protection during gameplay. They cover the lower legs, securing shin guards in place and providing an extra layer of cushioning.',
//     type: 'Football'
// },{
//     id: 6,
//     img: 'img/ball6.jpg',
//     name : 'Football Shirt',
//     price: 2900,
//     description: 'A football shirt, also known as a soccer jersey, is an essential part of a football players kit. It serves both functional and aesthetic purposes, designed to enhance performance and represent the team.',
//     type: 'Football'
// },{
//     id: 7,
//     img: 'img/bas1.jpg',
//     name : 'Basketball',
//     price: 899,
//     description: 'A basketball is a spherical ball designed for the sport of basketball. It is built to withstand the rigors of bouncing, passing, and shooting while providing players with optimal grip and control',
//     type: 'Basketball'
// },{
//     id: 8,
//     img: 'img/bas2.jpg',
//     name : 'Basketball shirt',
//     price: 1600,
//     description: 'A basketball shirt (often referred to as a jersey) is a specialized piece of athletic wear designed for basketball players. It provides comfort, mobility, and breathability during the fast-paced nature of the game.',
//     type: 'Basketball'
// },{
//     id: 9,
//     img: 'img/bas3.jpg',
//     name : 'Basketball Boots',
//     price: 2900,
//     description: 'A basketball boot (more commonly referred to as basketball shoes) is a specialized footwear designed specifically for basketball players. These shoes are built to provide support, traction, comfort, and protection during intense games and training sessions. ',
//     type: 'Basketball'
// },{
//     id: 10,
//     img: 'img/bas4.jpg',
//     name : 'Basketball short',
//     price: 399,
//     description: 'A basketball short is a specialized piece of clothing worn by basketball players, designed for comfort, mobility, and breathability during play. Basketball shorts are an essential part of a players uniform and help to enhance performance while maintaining flexibility and freedom of movement.',
//     type: 'Basketball'
// },{ 
//     // fixed below na ja---------------------------------------------------------------------------------------------------------------------
//     id: 11,
//     img: 'img/bas5.jpg',
//     name : 'Basketball Hoop',
//     price: 19900,
//     description: 'A basketball hoop is a key piece of equipment used in the game of basketball, designed for players to shoot the basketball into and score points. It consists of several components, including the rim, net, backboard, and mounting system.',
//     type: 'Basketball'
// },{
//     id: 12,
//     img: 'img/bat1.jpg',
//     name : 'Racket',
//     price: 1490,
//     description: 'A badminton racket is a lightweight and aerodynamic tool designed for hitting the shuttlecock in badminton. Its construction emphasizes speed, precision, and maneuverability.',
//     type: 'Badminton'
// },{
//     id: 13,
//     img: 'img/bat2.jpg',
//     name : 'Badminton Boots',
//     price: 2990,
//     description: 'Badminton shoes (commonly called badminton boots) are specifically designed footwear to support the dynamic movements and agility required in badminton. They provide grip, comfort, and protection, enabling players to perform effectively while minimizing the risk of injury.',
//     type: 'Badminton'
// },{
//     id: 14,
//     img: 'img/bat3.jpg',
//     name : 'Badminton Bag',
//     price: 1650,
//     description: 'A badminton bag is designed to store and protect badminton equipment, including rackets, shuttlecocks, shoes, clothing, and other accessories. It combines functionality, durability, and convenience to meet the needs of both casual players and professionals.',
//     type: 'Badminton'
// },{
//     id: 12,
//     img: 'img/bat4.jpg',
//     name : 'Shuttlecock',
//     price: 599,
//     description: 'A shuttlecock, also known as a birdie, is a projectile used in badminton. Its unique design allows it to travel at high speeds while maintaining a predictable trajectory and slowing down due to air resistance. Shuttlecocks come in two main types: feathered and synthetic (nylon). ',
//     type: 'Badminton'
// },{
//     id: 12,
//     img: 'img/bat5.jpg',
//     name : 'Badminton racket grip tape',
//     price: 129,
//     description: 'Badminton racket grip tape is an essential accessory that enhances a players hold on the racket, improving control, comfort, and performance. It helps prevent slipping, reduces vibrations, and absorbs sweat, making it crucial for optimal gameplay.',
//     type: 'Badminton'
// },{
//     id: 12,
//     img: 'img/tbt1.jpg',
//     name : 'Ping pong ball',
//     price: 699,
//     description: 'A ping pong ball, also known as a table tennis ball, is a lightweight, spherical object used in the game of table tennis. It is specifically designed to meet size, weight, and performance standards for recreational and professional play.',
//     type: 'Tabletennis'
// },{
//     id: 12,
//     img: 'img/tbt2.jpg',
//     name : 'Ping pong table ',
//     price: 25900,
//     description: 'A ping pong table, also known as a table tennis table, is the playing surface used in the sport of table tennis. Its design and dimensions are standardized to ensure consistent gameplay across recreational and competitive levels.',
//     type: 'Tabletennis'
// },{
//     id: 12,
//     img: 'img/tbt3.jpg',
//     name : 'Ping pong racket',
//     price: 690,
//     description: 'A ping pong racket (also known as a table tennis paddle or bat) is a handheld implement used to hit the ball in table tennis. It is carefully designed to provide precision, spin, and control.',
//     type: 'Tabletennis'
// },{
//     id: 12,
//     img: 'img/tbt4.jpg',
//     name : 'Ping pong net',
//     price: 3500,
//     description: 'A ping pong net is an essential part of the table tennis setup, dividing the table into two halves. It plays a crucial role in the game by ensuring that the ball passes through it correctly, affecting the outcome of each rally. ',
//     type: 'Tabletennis'
// },{
//     id: 12,
//     img: 'img/tbt5.jpg',
//     name : 'Ping pong boots',
//     price: 2900,
//     description: 'Ping pong boots are not commonly used in the sport of table tennis. Unlike sports like football or basketball, table tennis typically doesnâ€™t require specialized footwear. However, some players may wear certain types of shoes that help with performance during play, especially in competitive or high-intensity games. These shoes are generally referred to as table tennis shoes or ping pong shoes rather than "boots."',
//     type: 'Tabletennis'
// },{
//     id: 12,
//     img: 'img/ten1.jpg',
//     name : 'Tennis ball',
//     price: 1290,
//     description: 'A tennis ball is a crucial piece of equipment in the sport of tennis. It is designed to be durable, lightweight, and provide the right amount of bounce and spin for competitive play',
//     type: 'Tennis'
// },{
//     id: 12,
//     img: 'img/ten2.jpg',
//     name : 'Tennis racket',
//     price: 8990,
//     description: 'A tennis racket is an essential piece of equipment used in the sport of tennis, designed to strike the tennis ball during play. Tennis rackets come in various sizes, weights, and materials, all contributing to different styles of play.',
//     type: 'Tennis'
// },{
//     id: 12,
//     img: 'img/ten3.jpg',
//     name : 'Tennis Shoes',
//     price: 2790,
//     description: 'Tennis shoes are specially designed footwear meant to provide support, comfort, and performance during the sport of tennis. These shoes are engineered to withstand the intense movements and demands of the game, including quick lateral movements, sudden starts and stops, and constant footwork on various court surfaces.',
//     type: 'Tennis'
// },{
//     id: 12,
//     img: 'img/ten4.jpg',
//     name : 'Tennis chair',
//     price: 4990,
//     description: 'A tennis chair refers to the umpires chair used during professional tennis matches. It is an essential piece of equipment for officials overseeing the match, providing a high vantage point to monitor the game and make decisions.',
//     type: 'Tennis'
// },{
//     id: 12,
//     img: 'img/ten5.jpg',
//     name : 'Tennis ball machine',
//     price: 55900,
//     description: 'Tennis ball machine is a mechanical device designed to simulate the experience of playing against an opponent by shooting tennis balls toward the player. These machines are used for practice, allowing players to work on their skills, footwork, and stroke consistency. They can be found in tennis training centers, clubs, and even for personal use by enthusiasts.',
//     type: 'Tennis'
// },{
//     id: 12,
//     img: 'img/vol1.jpg',
//     name : 'Volleyball',
//     price: 650,
//     description: 'A volleyball is a spherical ball specifically designed for the sport of volleyball, with features tailored for indoor or outdoor play. ',
//     type: 'Volleyball'
// },{
//     id: 12,
//     img: 'img/vol2.jpg',
//     name : 'Volleyball shorts',
//     price: 299,
//     description: 'Volleyball shorts are specialized athletic wear designed for comfort, flexibility, and performance during volleyball matches. These shorts are worn by both male and female players and are essential for maximizing movement and ensuring players can move freely on the court.',
//     type: 'Volleyball'
// },{
//     id: 12,
//     img: 'img/vol3.jpg',
//     name : 'Volleyball Boots',
//     price: 2900,
//     description: 'Volleyball boots (or volleyball shoes) are specially designed footwear intended to meet the specific needs of volleyball players. These shoes offer the support, traction, and comfort necessary for the dynamic movements involved in the sport, such as quick lateral shifts, jumps, and sprints.',
//     type: 'Volleyball'
// },{
//     id: 12,
//     img: 'img/vol4.jpeg',
//     name : 'Volleyball braces pad',
//     price: 290,
//     description: 'Volleyball braces and pads are protective gear designed to provide additional support, stability, and comfort during volleyball games and practices. These items help prevent injuries, particularly to the knees, ankles, and wrists, which are vulnerable during the dynamic movements in volleyball, such as jumping, diving, and quick lateral movements.',
//     type: 'Volleyball'
// },{
//     id: 12,
//     img: 'img/vol5.jpg',
//     name : 'Volleyball shirt',
//     price: 1650,
//     description: 'A volleyball shirt is a key piece of attire worn by volleyball players during games and practices. These shirts are designed to provide comfort, flexibility, and breathability, ensuring that players can perform their best during intense and dynamic movements on the court.',
//     type: 'Volleyball'
// }];

var product;

// [{},{},{}] // length = 3

$(document).ready(() => {

    $.ajax({
        method: 'get',
        url: './api/getallproduct.php',
        success: function(response) {
            console.log(response    )
            if(response.RespCode == 200) {

                product = response.Result;

                var html = '';
                for (let i = 0; i < product.length; i++) {
                    html += `<div onclick="openProductDetail(${i})" class="product-items ${product[i].type}">
                                <img class="imgproduct" src="./img/${product[i].img}" alt="">
                                <p style="font-size: 1.2vw;color:rgb(0,0,0)">${product[i].name}</p>
                                <p stlye="font-size: 1vw;color:rgb(0,0,0)">${ numberWithCommas(product[i].price) } THB</p>
                                <img class="cartinpro"src="img/orange-cart-remover.png" alt="">
                            </div>`;
                }
                $("#productlist").html(html);
            }
        }, error: function(err) {
            console.log(err,'e')
        }
    })
})

function numberWithCommas(x) {
    x = x.toString();
    var pattern = /(-?\d+)(\d{3})/;
    while (pattern.test(x))
        x = x.replace(pattern, "$1,$2");
    return x;
}

function search(elem) {
    // console.log('#'+elem.id)
    var value = $('#'+elem.id).val()
    console.log(value)

    var html = '';
    for (let i = 0; i < product.length; i++) {
        if( product[i].name.includes(value) ) {
            html += `<div onclick="openProductDetail(${i})" class="product-items ${product[i].type}">
                    <img class="imgproduct" src="./img/${product[i].img}" alt="">
                    <p style="font-size: 1.2vw; color:rgb(0,0,0) ">${product[i].name}</p>
                    <p stlye="font-size: 1vw;">${ numberWithCommas(product[i].price) } THB</p>
                </div>`;
        }
    }
    if(html == '') {
        $("#productlist").html(`<p style="color:rgb(0,0,0); " >Not found product</p>`);
    } else {
        $("#productlist").html(html);
    }

}

function searchproduct(param) {
    console.log(param)
    $(".product-items").css('display', 'none')
    if(param == 'all') {
        $(".product-items").css('display', 'block')
    }
    else {
        $("."+param).css('display', 'block')
    }
}

var productindex = 0;
function openProductDetail(index) {
    productindex = index;
    console.log(productindex)
    $("#modleDesc").css('display', 'flex')
    $("#mdd-img").attr('src','./img/'+ product[index].img);
    $("#mdd-name").text(product[index].name);
    $("#mdd-price").text(numberWithCommas(product[index].price) + ' THB');
    $("#mdd-desc").text(product[index].description);
}

function closeModal() {
    $(".modal").css('display','none')
}

var cart = [];
function addtocart() {
    var pass = true;

    for (let i = 0; i < cart.length; i++) {
        if( productindex == cart[i].index ) {
            console.log('found same product')
            cart[i].count++;
            pass = false;
        }
    }

    if(pass) {
        var obj = {
            index: productindex,
            id: product[productindex].id,
            name: product[productindex].name,
            price: product[productindex].price,
            img: product[productindex].img,
            count: 1
        };
        // console.log(obj)
        cart.push(obj)
    }
    console.log(cart)

    Swal.fire({
        icon: 'success',
        title: 'Add ' + product[productindex].name + ' to cart !'
    })
    $("#cartcount").css('display','flex').text(cart.length)
}

function openCart() {
    $('#modalCart').css('display','flex')
    rendercart();
}

function rendercart() {
    if(cart.length > 0) {
        var html = '';
        for (let i = 0; i < cart.length; i++) {
            html += `<div class="cartlist-items">
                        <div class="cartlist-left">
                            <img src="./img/${cart[i].img}" alt="">
                            <div class="cartlist-detail">
                                <p style="font-size: 1.5vw;">${cart[i].name}</p>
                                <p style="font-size: 1.2vw;">${ numberWithCommas(cart[i].price * cart[i].count) } THB</p>
                            </div>
                        </div>
                        <div class="cartlist-right">
                            <p onclick="deinitems('-', ${i})" class="btnc">-</p>
                            <p id="countitems${i}" style="margin: 0 20px;">${cart[i].count}</p>
                            <p onclick="deinitems('+', ${i})" class="btnc">+</p>
                        </div>
                    </div>`;
        }
        $("#mycart").html(html)
    }
    else {
        $("#mycart").html(`<p>Not found product list</p>`)
    }
}

function deinitems(action, index) {
    if(action == '-') {
        if(cart[index].count > 0) {
            cart[index].count--;
            $("#countitems"+index).text(cart[index].count)

            if(cart[index].count <= 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Are you sure to delete?',
                    showConfirmButton: true,
                    showCancelButton: true,
                    confirmButtonText: 'Delete',
                    cancelButtonText: 'Cancel'
                }).then((res) => {
                  if(res.isConfirmed) {
                     cart.splice(index, 1) 
                     console.log(cart)
                     rendercart();
                     $("#cartcount").css('display','flex').text(cart.length)
                     
                     if(cart.length <= 0) {
                        $("#cartcount").css('display','none')
                     }
                  }  
                  else {
                    cart[index].count++;
                    $("#countitems"+index).text(cart[index].count)
                  }
                })
            }
        }
    }
    else if(action == '+') {
        cart[index].count++;
        $("#countitems"+index).text(cart[index].count)
    }
}
function buynow(){
    $.ajax({
        method : 'post',
        url: './api/buynow.php',
        data: {
            product:cart

        }, success: function(response){
            console.log(response)
            if(response.RespCode=200){
                Swal.fire({
                    icon:"success",
                    title:"Payment successful",
                    html: ` <p> Amount : ${response.Amount.Amount}</p>
                            <p> Shipping : ${response.Amount.Shipping}</p>
                            <p> Vat : ${response.Amount.Vat}</p>
                            <p> Netamount : ${response.Amount.Netamount}</p>`
                }).then((res) => {
                    if(res.isConfirmed) {
                        cart = [];
                        closeModal();
                        $("#cartcount").css('display','none')
                    }
                })
                    
                
            }
            else{
                Swal.fire({ 
                    icon:"error",
                    title:"Something's went wrong"
                })

            }
        }, error:function(err){
            console.log(err)
        }


    })

}

